<main class="main-content">
  <div class="content-header">
    <div class="header-line">
      <h1>Gerenciamento de Produtos</h1>
      <button class="btn-default" (click)="abrirModalCriacao()">
        <span class="material-symbols-sharp">add_circle</span>
        Novo Produto
      </button>
    </div>
    <p>Adicione, visualize e gerencie os produtos do estoque.</p>
  </div>

  <section class="results-section form-card">
    <h2>Produtos Cadastrados</h2>

    @if (carregando) {
    <p>Carregando produtos...</p>
    } @else if (listaProdutos.length) {
    <div class="table-container">
      <table class="data-table" id="produtosTable">
        <thead>
          <tr>
            <th class="col-codigo">Código</th>
            <th class="col-nome">Nome</th>
            <th class="col-categoria">Categoria</th>
            <th class="col-preco">Preço</th>
            <th class="col-qtd">Qtd. Atual</th>
            <th class="col-qtd">Qtd. Mínima</th>
            <th class="col-status">Status</th>
            <th class="col-acoes">Ações</th>
          </tr>
        </thead>
        <tbody>
          @for (p of listaProdutos; track p.id) {
          <tr>
            <td class="col-codigo">{{ p.codigo }}</td>
            <td class="col-nome" title="{{ p.nome }}">{{ p.nome }}</td>
            <td class="col-categoria">{{ p.categoria?.nome }}</td>
            <td class="col-preco">{{ p.preco | currency : 'BRL' }}</td>
            <td class="col-qtd">{{ p.quantidadeAtual }}</td>
            <td class="col-qtd">{{ p.quantidadeMinima }}</td>
            <td class="col-status">
              <span [style.color]="p.ativo ? 'green' : 'red'">
                {{ p.ativo ? 'Ativo' : 'Inativo' }}
              </span>
            </td>
            <td class="col-acoes">
              <button type="button" (click)="abrirModalEdicao(p)" title="Editar">
                <span class="material-symbols-sharp">edit</span>
              </button>
              <button
                type="button"
                (click)="excluir(p.id)"
                title="Excluir"
                style="color: var(--color-danger)"
              >
                <span class="material-symbols-sharp">delete</span>
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    } @else {
    <p class="empty-message">Nenhum produto cadastrado.</p>
    }
  </section>
</main>

@if (mostrarModal) {
<app-produto-form [produtoId]="produtoIdParaEditar" (close)="fecharModal($event)">
</app-produto-form>
}
